generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id               String            @id @default(uuid())
  email            String            @unique
  senhaHash        String
  telefone         String?
  nome             String?
  username         String            @unique
  role             Role?             @default(cultivador)
  onBoarding       Boolean           @default(false)
  endereco         String?
  pictureUrl       String?
  resetToken       String?
  resetTokenExpiry DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  Disponibilidade  Disponibilidade?
  familiasGestor   Familia[]         @relation("GestorFamilia")
  hortasGestor     Horta[]           @relation("GestorHortas")
  Log              Log[]
  Notificacao      Notificacao[]
  PerfilAdmin      PerfilAdmin?
  PerfilCultivador PerfilCultivador?
  PerfilGestor     PerfilGestor?
  PerfilVoluntario PerfilVoluntario?
  familiasMembro   Familia?          @relation("UsuarioFamilia", fields: [familiaId], references: [id])
  familiaId        String?
}

model PerfilGestor {
  id                   String  @id @default(uuid())
  usuarioId            String  @unique
  cargo                String?
  recebeAlertas        Boolean @default(true)
  organizacaoVinculada String
  observacoes          String?
  usuario              Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
    createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Disponibilidade {
  id                 String            @id @default(uuid())
  usuarioId          String            @unique
  diaSemana          DiaSemana
  horarioIni         DateTime
  horarioFim         DateTime
  perfilVoluntarioId String?
  PerfilVoluntario   PerfilVoluntario? @relation(fields: [perfilVoluntarioId], references: [id])
  usuario            Usuario           @relation(fields: [usuarioId], references: [id])
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model PerfilVoluntario {
  id              String            @id @default(uuid())
  usuarioId       String            @unique
  interesse       String?
  disponivel      Boolean           @default(true)
  observacoes     String?
  disponibilidade Disponibilidade[]
  usuario         Usuario           @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PerfilCultivador {
  id               String  @id @default(uuid())
  usuarioId        String  @unique
  tipoExperiencia  String?
  habilidades      String?
  plantasFavoritas String?
  observacoes      String?
  usuario          Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
    createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model PerfilAdmin {
  id          String  @id @default(uuid())
  cargo       String
  ativo       Boolean
  observacoes String?
  usuarioId   String  @unique
  usuario     Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
    createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Familia {
  id         String    @id @default(uuid())
  nome       String
  representante String
  qtdMembros Int
  descricao  String?
  gestorId   String
  avisos     Aviso[]
  gestor     Usuario   @relation("GestorFamilia", fields: [gestorId], references: [id])
  hortas     Horta[]   @relation("HortasFamilia")
  membros    Usuario[] @relation("UsuarioFamilia")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Horta {
  id            String    @id @default(uuid())
  nome          String
  areaCultivada Decimal
  tipoSolo      String
  tipoHorta     EHorta
  observacoes   String?
  familiaId     String?
  coordenada    String?
  descricao     String?
  endereco      String
  gestorId      String?
  familia       Familia?  @relation("HortasFamilia", fields: [familiaId], references: [id])
  gestor        Usuario?  @relation("GestorHortas", fields: [gestorId], references: [id])
  plantios      Plantio[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Plantio {
  id               String    @id @default(uuid())
  tipoPlantacao    String
  previsaoColheita DateTime
  quantidadePlantada Decimal
  unidadeMedida    String
  observacoes      String?
  hortaId          String
  colheitaId       String?   @unique
  cultura          String
  dataColheita     DateTime?
  dataInicio       DateTime
  colheita         Colheita?
  horta            Horta     @relation(fields: [hortaId], references: [id], onDelete: Cascade)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model Colheita {
  id              String   @id @default(uuid())
  dataColheita    DateTime @default(now())
  quantidadeColhida Decimal
  unidadeMedida   String
  destinoColheita String
  plantioId       String   @unique
  observacoes     String?
  cultura         String
  plantio         Plantio  @relation(fields: [plantioId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Aviso {
  id         String   @id @default(uuid())
  titulo     String
  descricao  String
  dataEvento DateTime
  familiaId  String
  familia    Familia  @relation(fields: [familiaId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Notificacao {
  id        String   @id @default(uuid())
  usuarioId String
  titulo    String
  mensagem  String
  lida      Boolean  @default(false)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Log {
  id        String   @id @default(uuid())
  usuarioId String
  acao      String
  contexto  String?
  data      DateTime @default(now())
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Faq {
  id        String   @id @default(uuid())
  pergunta  String
  resposta  String
  categoria String?
  ordem     Int?
  criadoEm  DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  admin
  gestor
  voluntario
  cultivador
}

enum DiaSemana {
  DOM
  SEG
  TER
  QUA
  QUI
  SEX
  SAB
}

enum EHorta {
  escolar
  comunitaria
  institucional
  ong
  familiar
}
